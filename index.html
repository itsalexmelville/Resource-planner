<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Studio Forecasting</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        ReactDOM.render(<DesignStudioForecastingApp />, document.getElementById('root'));
    </script>
</body>
</html>// Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCY2KvEMW4hvXN6ai2kS3Wmcv-F3BMUGZQ",
          authDomain: "design-studio-forecasting.firebaseapp.com",
          databaseURL: "https://design-studio-forecasting-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "design-studio-forecasting",
          storageBucket: "design-studio-forecasting.firebasestorage.app",
          messagingSenderId: "1024840702386",
          appId: "1:1024840702386:web:71cd7b8e5df551cc8d2cab"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const { useState, useEffect } = React;

        // Simple icon components
        const Plus = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
        );

        const X = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Users = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const Briefcase = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6z" />
            </svg>
        );

        const Calendar = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const Clock = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const ChevronLeft = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
        );

        const ChevronRight = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
        );

        // Week Selector Component
        const WeekSelector = ({ currentWeek, onWeekSelect }) => {
          const [showCalendar, setShowCalendar] = useState(false);
          const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());

          const getWeekStartDate = (weekIndex) => {
            const startOfYear = new Date(selectedYear, 0, 1);
            let firstMonday = new Date(startOfYear);
            while (firstMonday.getDay() !== 1) {
              firstMonday.setDate(firstMonday.getDate() + 1);
            }
            const weekStart = new Date(firstMonday);
            weekStart.setDate(firstMonday.getDate() + (weekIndex * 7));
            return weekStart;
          };

          const formatWeekRange = (weekIndex) => {
            const start = getWeekStartDate(weekIndex);
            const end = new Date(start);
            end.setDate(start.getDate() + 4); // Friday
            return `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
          };

          const currentWeekRange = formatWeekRange(currentWeek);

          return (
            <div className="relative">
              <button
                onClick={() => setShowCalendar(!showCalendar)}
                className="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                <Calendar />
                <div className="text-left">
                  <div className="font-semibold">Week {currentWeek + 1}, {selectedYear}</div>
                  <div className="text-sm text-gray-600">{currentWeekRange}</div>
                </div>
              </button>

              {showCalendar && (
                <div className="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-20 w-80">
                  <div className="p-4 border-b flex items-center justify-between">
                    <button
                      onClick={() => setSelectedYear(selectedYear - 1)}
                      className="p-1 hover:bg-gray-100 rounded"
                    >
                      <ChevronLeft />
                    </button>
                    <h3 className="font-semibold">{selectedYear}</h3>
                    <button
                      onClick={() => setSelectedYear(selectedYear + 1)}
                      className="p-1 hover:bg-gray-100 rounded"
                    >
                      <ChevronRight />
                    </button>
                  </div>
                  
                  <div className="max-h-64 overflow-y-auto p-2">
                    <div className="grid grid-cols-4 gap-1">
                      {Array.from({ length: 52 }, (_, i) => (
                        <button
                          key={i}
                          onClick={() => {
                            onWeekSelect(i);
                            setShowCalendar(false);
                          }}
                          className={`p-2 text-xs rounded hover:bg-blue-50 ${
                            i === currentWeek ? 'bg-blue-600 text-white' : 'text-gray-700'
                          }`}
                        >
                          <div className="font-medium">W{i + 1}</div>
                          <div className="text-xs">{formatWeekRange(i)}</div>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const DesignStudioForecastingApp = () => {
          // Initialize state
          const [designers, setDesigners] = useState([
            { id: 1, name: 'Jazmine' },
            { id: 2, name: 'Josh' },
            { id: 3, name: 'Alex' },
            { id: 4, name: 'Darren' }
          ]);

          const [projects, setProjects] = useState([
            { id: 1, name: 'Project Alpha', color: '#3B82F6' },
            { id: 2, name: 'Project Beta', color: '#EF4444' }
          ]);

          const [currentWeek, setCurrentWeek] = useState(0);
          const [numWeeks, setNumWeeks] = useState(52);
          const [allocations, setAllocations] = useState({});
          const [newDesignerName, setNewDesignerName] = useState('');
          const [newProjectName, setNewProjectName] = useState('');
          const [isLoading, setIsLoading] = useState(true);

          const DAILY_CAPACITY = 7;
          const DAYS_PER_WEEK = 5;

          // Load data from Firebase on startup
          useEffect(() => {
            const loadData = async () => {
              try {
                // Load designers
                const designersSnapshot = await database.ref('designers').once('value');
                if (designersSnapshot.exists()) {
                  setDesigners(designersSnapshot.val());
                }

                // Load projects
                const projectsSnapshot = await database.ref('projects').once('value');
                if (projectsSnapshot.exists()) {
                  setProjects(projectsSnapshot.val());
                }

                // Load allocations
                const allocationsSnapshot = await database.ref('allocations').once('value');
                if (allocationsSnapshot.exists()) {
                  setAllocations(allocationsSnapshot.val());
                }

                // Load current week
                const weekSnapshot = await database.ref('currentWeek').once('value');
                if (weekSnapshot.exists()) {
                  setCurrentWeek(weekSnapshot.val());
                }
              } catch (error) {
                console.error('Error loading data:', error);
              } finally {
                setIsLoading(false);
              }
            };

            loadData();
          }, []);

          // Save data to Firebase
          const saveToFirebase = async (path, data) => {
            try {
              await database.ref(path).set(data);
            } catch (error) {
              console.error('Error saving to Firebase:', error);
            }
          };

          // Generate date labels for the current week
          const getWeekDates = (weekIndex) => {
            const dates = [];
            const today = new Date();
            const startOfYear = new Date(today.getFullYear(), 0, 1);
            
            // Find first Monday of the year
            let firstMonday = new Date(startOfYear);
            while (firstMonday.getDay() !== 1) {
              firstMonday.setDate(firstMonday.getDate() + 1);
            }
            
            // Calculate the start of the target week
            const weekStart = new Date(firstMonday);
            weekStart.setDate(firstMonday.getDate() + (weekIndex * 7));
            
            for (let i = 0; i < DAYS_PER_WEEK; i++) {
              const date = new Date(weekStart);
              date.setDate(weekStart.getDate() + i);
              dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            }
            return dates;
          };

          // Get allocation key
          const getAllocationKey = (designerId, projectId, weekIndex, dayIndex) => {
            return `${designerId}-${projectId}-${weekIndex}-${dayIndex}`;
          };

          // Get allocation value
          const getAllocation = (designerId, projectId, weekIndex, dayIndex) => {
            const key = getAllocationKey(designerId, projectId, weekIndex, dayIndex);
            return allocations[key] || 0;
          };

          // Update allocation
          const updateAllocation = (designerId, projectId, weekIndex, dayIndex, hours) => {
            const key = getAllocationKey(designerId, projectId, weekIndex, dayIndex);
            const numHours = Math.max(0, Math.min(DAILY_CAPACITY, parseFloat(hours) || 0));
            const newAllocations = {
              ...allocations,
              [key]: numHours
            };
            setAllocations(newAllocations);
            saveToFirebase('allocations', newAllocations);
          };

          // Calculate total hours for a designer on a specific day
          const getDailyTotal = (designerId, weekIndex, dayIndex) => {
            return projects.reduce((total, project) => {
              return total + getAllocation(designerId, project.id, weekIndex, dayIndex);
            }, 0);
          };

          // Calculate weekly totals
          const getWeeklyTotal = (designerId, weekIndex) => {
            let total = 0;
            for (let day = 0; day < DAYS_PER_WEEK; day++) {
              total += getDailyTotal(designerId, weekIndex, day);
            }
            return total;
          };

          // Calculate project totals
          const getProjectTotal = (projectId, weekIndex) => {
            let total = 0;
            for (let day = 0; day < DAYS_PER_WEEK; day++) {
              designers.forEach(designer => {
                total += getAllocation(designer.id, projectId, weekIndex, day);
              });
            }
            return total;
          };

          // Add designer
          const addDesigner = () => {
            if (newDesignerName.trim()) {
              const newId = Math.max(...designers.map(d => d.id), 0) + 1;
              const newDesigners = [...designers, { id: newId, name: newDesignerName.trim() }];
              setDesigners(newDesigners);
              saveToFirebase('designers', newDesigners);
              setNewDesignerName('');
            }
          };

          // Remove designer
          const removeDesigner = (id) => {
            if (designers.length > 1) {
              const newDesigners = designers.filter(d => d.id !== id);
              setDesigners(newDesigners);
              saveToFirebase('designers', newDesigners);
              
              // Clean up allocations for removed designer
              const newAllocations = { ...allocations };
              Object.keys(newAllocations).forEach(key => {
                if (key.startsWith(`${id}-`)) {
                  delete newAllocations[key];
                }
              });
              setAllocations(newAllocations);
              saveToFirebase('allocations', newAllocations);
            }
          };

          // Add project
          const addProject = () => {
            if (newProjectName.trim()) {
              const colors = ['#10B981', '#8B5CF6', '#F59E0B', '#06B6D4', '#84CC16', '#EC4899'];
              const newId = Math.max(...projects.map(p => p.id), 0) + 1;
              const color = colors[projects.length % colors.length];
              const newProjects = [...projects, { id: newId, name: newProjectName.trim(), color }];
              setProjects(newProjects);
              saveToFirebase('projects', newProjects);
              setNewProjectName('');
            }
          };

          // Remove project
          const removeProject = (id) => {
            if (projects.length > 1) {
              const newProjects = projects.filter(p => p.id !== id);
              setProjects(newProjects);
              saveToFirebase('projects', newProjects);
              
              // Clean up allocations for removed project
              const newAllocations = { ...allocations };
              Object.keys(newAllocations).forEach(key => {
                if (key.includes(`-${id}-`)) {
                  delete newAllocations[key];
                }
              });
              setAllocations(newAllocations);
              saveToFirebase('allocations', newAllocations);
            }
          };

          // Handle week selection
          const handleWeekSelect = (weekIndex) => {
            setCurrentWeek(weekIndex);
            saveToFirebase('currentWeek', weekIndex);
          };

          const weekDates = getWeekDates(currentWeek);

          // Show loading state while data loads
          if (isLoading) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                  <p className="text-gray-600">Loading your forecast data...</p>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50 p-6">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="mb-8">
                  <h1 className="text-3xl font-bold text-gray-900 mb-2">Design Studio Forecasting</h1>
                  <p className="text-gray-600">Manage your team's capacity and project allocations</p>
                </div>

                {/* Controls */}
                <div className="bg-white rounded-lg shadow-sm border p-6 mb-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* Team Management */}
                    <div>
                      <h3 className="text-lg font-semibold mb-3 flex items-center">
                        <Users />
                        <span className="ml-2">Team Management</span>
                      </h3>
                      <div className="space-y-2">
                        <div className="flex gap-2">
                          <input
                            type="text"
                            placeholder="Designer name"
                            value={newDesignerName}
                            onChange={(e) => setNewDesignerName(e.target.value)}
                            className="flex-1 px-3 py-2 border rounded-md text-sm"
                            onKeyPress={(e) => e.key === 'Enter' && addDesigner()}
                          />
                          <button
                            onClick={addDesigner}
                            className="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm"
                          >
                            <Plus />
                          </button>
                        </div>
                        <div className="text-sm text-gray-600">
                          Team: {designers.length} designers × {DAILY_CAPACITY}h/day
                        </div>
                      </div>
                    </div>

                    {/* Project Management */}
                    <div>
                      <h3 className="text-lg font-semibold mb-3 flex items-center">
                        <Briefcase />
                        <span className="ml-2">Project Management</span>
                      </h3>
                      <div className="space-y-2">
                        <div className="flex gap-2">
                          <input
                            type="text"
                            placeholder="Project name"
                            value={newProjectName}
                            onChange={(e) => setNewProjectName(e.target.value)}
                            className="flex-1 px-3 py-2 border rounded-md text-sm"
                            onKeyPress={(e) => e.key === 'Enter' && addProject()}
                          />
                          <button
                            onClick={addProject}
                            className="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm"
                          >
                            <Plus />
                          </button>
                        </div>
                        <div className="text-sm text-gray-600">
                          Active: {projects.length} projects
                        </div>
                        <div className="mt-2 space-y-1 max-h-24 overflow-y-auto">
                          {projects.map(project => (
                            <div key={project.id} className="flex items-center justify-between text-sm py-1 px-2 bg-gray-50 rounded">
                              <div className="flex items-center">
                                <div 
                                  className="w-3 h-3 rounded-full mr-2"
                                  style={{ backgroundColor: project.color }}
                                ></div>
                                <span className="truncate">{project.name}</span>
                              </div>
                              <button
                                onClick={() => removeProject(project.id)}
                                className="text-red-600 hover:text-red-800 ml-2"
                                disabled={projects.length <= 1}
                                title="Remove project"
                              >
                                <X />
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>

                    {/* Week Navigation */}
                    <div>
                      <h3 className="text-lg font-semibold mb-3 flex items-center">
                        <Calendar />
                        <span className="ml-2">Week Navigation</span>
                      </h3>
                      <div className="space-y-3">
                        <WeekSelector 
                          currentWeek={currentWeek}
                          onWeekSelect={handleWeekSelect}
                        />
                        
                        <div className="flex gap-2">
                          <button
                            onClick={() => handleWeekSelect(Math.max(0, currentWeek - 1))}
                            className="px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm"
                            disabled={currentWeek === 0}
                          >
                            ← Prev
                          </button>
                          <button
                            onClick={() => handleWeekSelect(Math.min(numWeeks - 1, currentWeek + 1))}
                            className="px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm"
                            disabled={currentWeek === numWeeks - 1}
                          >
                            Next →
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Main Forecasting Grid */}
                <div className="bg-white rounded-lg shadow-sm border overflow-hidden">
                  <div className="p-4 bg-gray-50 border-b">
                    <h2 className="text-xl font-semibold flex items-center">
                      <Clock />
                      <span className="ml-2">Week {currentWeek + 1} Allocation - {weekDates[0]} to {weekDates[4]}</span>
                    </h2>
                  </div>

                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead>
                        <tr className="bg-gray-50 border-b">
                          <th className="text-left p-3 font-semibold">Designer</th>
                          {weekDates.map((date, index) => (
                            <th key={index} className="text-center p-3 font-semibold min-w-32">
                              {date}
                            </th>
                          ))}
                          <th className="text-center p-3 font-semibold">Week Total</th>
                          <th className="text-center p-3 font-semibold">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {designers.map((designer) => (
                          <React.Fragment key={designer.id}>
                            {/* Designer name row */}
                            <tr className="border-b bg-blue-50">
                              <td className="p-3 font-semibold text-blue-900" colSpan={8}>
                                {designer.name}
                                <button
                                  onClick={() => removeDesigner(designer.id)}
                                  className="ml-2 text-red-600 hover:text-red-800"
                                  disabled={designers.length <= 1}
                                >
                                  <X />
                                </button>
                              </td>
                            </tr>
                            
                            {/* Project allocation rows for this designer */}
                            {projects.map((project) => (
                              <tr key={`${designer.id}-${project.id}`} className="border-b hover:bg-gray-50">
                                <td className="p-3 pl-8 text-sm">
                                  <div className="flex items-center">
                                    <div 
                                      className="w-3 h-3 rounded-full mr-2"
                                      style={{ backgroundColor: project.color }}
                                    ></div>
                                    {project.name}
                                  </div>
                                </td>
                                
                                {/* Daily allocation inputs */}
                                {Array.from({ length: DAYS_PER_WEEK }).map((_, dayIndex) => {
                                  const currentAllocation = getAllocation(designer.id, project.id, currentWeek, dayIndex);
                                  const dailyTotal = getDailyTotal(designer.id, currentWeek, dayIndex);
                                  const isOverCapacity = dailyTotal > DAILY_CAPACITY;
                                  
                                  return (
                                    <td key={dayIndex} className="p-2 text-center">
                                      <input
                                        type="number"
                                        min="0"
                                        max={DAILY_CAPACITY}
                                        step="0.5"
                                        value={currentAllocation || ''}
                                        onChange={(e) => updateAllocation(designer.id, project.id, currentWeek, dayIndex, e.target.value)}
                                        className={`w-16 px-2 py-1 text-center border rounded text-sm ${
                                          isOverCapacity ? 'border-red-300 bg-red-50' : 'border-gray-300'
                                        }`}
                                        placeholder="0"
                                      />
                                    </td>
                                  );
                                })}
                                
                                {/* Week total for this project */}
                                <td className="p-3 text-center text-sm font-medium">
                                  {Array.from({ length: DAYS_PER_WEEK }).reduce((total, _, dayIndex) => 
                                    total + getAllocation(designer.id, project.id, currentWeek, dayIndex), 0
                                  ).toFixed(1)}h
                                </td>
                                
                                <td className="p-3"></td>
                              </tr>
                            ))}
                            
                            {/* Daily totals row for this designer */}
                            <tr className="border-b bg-gray-100">
                              <td className="p-3 pl-8 text-sm font-semibold">Daily Totals</td>
                              {Array.from({ length: DAYS_PER_WEEK }).map((_, dayIndex) => {
                                const total = getDailyTotal(designer.id, currentWeek, dayIndex);
                                const isOverCapacity = total > DAILY_CAPACITY;
                                return (
                                  <td key={dayIndex} className={`p-3 text-center font-semibold text-sm ${
                                    isOverCapacity ? 'text-red-600' : total === DAILY_CAPACITY ? 'text-green-600' : 'text-gray-900'
                                  }`}>
                                    {total.toFixed(1)}h / {DAILY_CAPACITY}h
                                  </td>
                                );
                              })}
                              <td className="p-3 text-center font-semibold text-sm">
                                {getWeeklyTotal(designer.id, currentWeek).toFixed(1)}h / {DAILY_CAPACITY * DAYS_PER_WEEK}h
                              </td>
                              <td className="p-3"></td>
                            </tr>
                          </React.Fragment>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>

                {/* Project Summary */}
                <div className="mt-6 bg-white rounded-lg shadow-sm border p-6">
                  <h3 className="text-lg font-semibold mb-4">Project Summary - Week {currentWeek + 1}</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {projects.map(project => {
                      const projectTotal = getProjectTotal(project.id, currentWeek);
                      return (
                        <div key={project.id} className="p-4 border rounded-lg">
                          <div className="flex items-center mb-2">
                            <div 
                              className="w-4 h-4 rounded-full mr-2"
                              style={{ backgroundColor: project.color }}
                            ></div>
                            <h4 className="font-semibold">{project.name}</h4>
                          </div>
                          <p className="text-2xl font-bold text-gray-900">{projectTotal.toFixed(1)}h</p>
                          <p className="text-sm text-gray-600">Total allocated this week</p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          );
        };
